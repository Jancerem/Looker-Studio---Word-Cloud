<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Word Cloud UANL - D3</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js"></script>
<style>
  body {
    background: #1a1a1a;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    font-family: Arial, sans-serif;
  }
  svg {
    width: 90%;
    height: 90%;
  }
</style>
</head>
<body>
<svg id="wordcloud"></svg>

<script>
const SHEET_JSON_URL = "https://script.google.com/macros/s/AKfycbzKoU7hWOvbV_xF8_gO6ayMgbKP1uzlg0SYd7R-WCmGiGFOAXlhYGroc6FaxYxIlOG7/exec";

fetch(SHEET_JSON_URL)
  .then(response => response.json())
  .then(data => {

    const maxFreq = d3.max(data, d => d[1]);

    const words = data.map(d => ({
      text: d[0],
      size: 20 + (d[1] / maxFreq) * 80 // tamaño mínimo 20px, máximo proporcional a frecuencia
    }));

    const layout = d3.layout.cloud()
      .size([window.innerWidth * 0.9, window.innerHeight * 0.9])
      .words(words)
      .padding(5)
      .rotate(() => (Math.random() < 0.1 ? 90 : 0)) // pocas rotaciones para legibilidad
      .font('Arial')
      .fontSize(d => d.size)
      .on('end', draw);

    layout.start();

    function draw(words) {
      d3.select("#wordcloud")
        .attr("width", layout.size()[0])
        .attr("height", layout.size()[1])
        .append("g")
        .attr("transform", "translate(" + layout.size()[0]/2 + "," + layout.size()[1]/2 + ")")
        .selectAll("text")
        .data(words)
        .enter().append("text")
        .style("font-size", d => d.size + "px")
        .style("fill", d => d3.interpolateTurbo(d.size / 100)) // gradiente de color
        .attr("text-anchor", "middle")
        .attr("transform", d => "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")")
        .text(d => d.text);
    }
  })
  .catch(err => console.error("Error cargando datos:", err));
</script>
</body>
</html>
